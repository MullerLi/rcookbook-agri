---
title: "R Cookbook for Agricultural Research"
author: "李誠紘 Cheng Hong, Li"
date: "`r Sys.Date()`"
knit: "bookdown::render_book"
bibliography: [book.bib, packages.bib]
biblio-style: apalike
site: bookdown::bookdown_site
output: bookdown::gitbook
documentclass: book
github-repo: MullerLi/rcookbook-agri
description: "利用R程式語言完成農學試驗的統計分析"
url: 'https://mullerli.github.io/rcookbook-agri/'
---

# 關於

Placeholder


## 這是什麼?

<!--chapter:end:index.Rmd-->


# 開始之前

Placeholder


## 為什麼要用R?
## 下載與安裝R
## 第一個 R 程式碼
## 第一張圖
## 學習地圖(Roadmap)
### RStudio訪問
### 參考書
## 資源

<!--chapter:end:01-intro.Rmd-->


# 敘述統計

Placeholder


## 資料格式
## 讀取資料
## 敘述統計量表

<!--chapter:end:02-describe.Rmd-->


# 平均值檢定

Placeholder


## 利用t檢定比較兩個族群平均值
### 資料下載
### 兩樣本t檢定

<!--chapter:end:03-ttest.Rmd-->

# ANOVA

ANOVA是變異數分析(analysis of variance)的英文縮寫，當想要了解3個以上平均值之間是否有差異時可以採用。

當平均值只有2個的時候，計算ANOVA就等同於計算相同變異數相同的T檢定，此時ANOVA計算的F值為T值的平方。

$Y_{ij}=\mu+\alpha_i+\epsilon_{ij}$

## 前提假設

+--------------------+----------------------------------------------------+------------------------------------+
| 前提假設           | 檢定(用R)                                          | 補救方案                           |
+====================+====================================================+====================================+
| 樣本常態與誤差獨立 | qqnorm(data)                                       | 1.  開根號                         |
|                    |                                                    | 2.  取log                          |
|                    | shapiro.test(data)                                 | 3.  倒數平方根                     |
|                    |                                                    | 4.  倒數                           |
|                    |                                                    | 5.  Box-Cox數據轉換 (MASS::boxcox) |
+--------------------+----------------------------------------------------+------------------------------------+
| 變異數均值         | bartlett.test(score \~ group, data = df)           | 同上                               |
|                    |                                                    |                                    |
|                    | car::leveneTest(iris\$Sepal.Length\~iris\$Species) |                                    |
|                    |                                                    |                                    |
|                    | 顯著代表                                           |                                    |
+--------------------+----------------------------------------------------+------------------------------------+

1.  樣本與誤差具常態性且彼此獨立 ( $\epsilon \sim {\sf NID}(0,\sigma^2)$ )

2.  變異數均值假設

    -   樣本是來自變異數相等的族群，譬如利用某機器量測一群稻穀樣本的重量，每次量測時，機器顯示的重量，都會受到機器本身設定的影響，呈現真實重量的固定百分比，因此具有這一群稻穀樣本會有相等的變異數。
    -   當違反假設，且變因是固定型效應，在處理重複數量均衡（彼此相同）時，對Fo僅有微弱的影響；但在處理數不均衡時，則會使顯著水準或型I錯誤率與預期值偏離。當變因是隨機型效應時，不論處理是否均衡，違反假設都會造成極大影響。

### 檢驗方式

1.  常態性檢定：
    -   機率分布圖(QQ plot)：將殘差計算出來，從大排到小，按數據點在圖形上。如果屬於常態分佈，會像是一條直線，不會偏離太多。

        -   使用`qqnorm`查看QQ-plot

        ```{r include = TRUE}
        qqnorm(iris$Sepal.Length)
        ```

        -   使用`shapiro.tes`檢定

        ```{r include = TRUE}
        shapiro.test(iris$Sepal.Length)
        ```
        
        


2.  獨立性與變異數均值的檢定：
    -   順序與殘差圖：殘差如不獨立，彼此會有相關性，會一連串的正或負。將實驗進行的時間順序為X軸，殘差為Y軸作圖，應該是無結構的。
    -   配適值與殘差圖：x軸為配適值(fitted value)，y軸為殘差(residuel)作圖。若殘差彼此之間獨立，ϵij畫出的圖不會有結構。喇叭狀代表違反獨立性與變異數均值假設。
        -   $\hat y_{ij}=\bar y_{i.}+\epsilon_{ij}$
        


3.  變異數均值的檢定：
$H_0:\sigma_1^2=\sigma_2^2=...=\sigma_a^2$ $H_1:至少有一個\sigma_i^2不一樣$
-   Barlett's test：顯著代表變異數不相等
-   Levene's test：顯著代表變異數不相等。
```{r}
leveneTest(iris$Sepal.Length~iris$Species)
```
```{r}
bartlett.test(iris$Sepal.Length~iris$Species)
```
上述兩個檢定皆為顯著，顯示iris數據的Sepal.Length在Species之間違反變異數相等的假說。

### 

1.  開根號
2.  取log
3.  倒數平方根
4.  倒數
5.  Box-Cox方法
    1.  先求$\lambda$值，計算log-likeyhood峰值的lambda值
    2.  根據$\lambda$大小，大於０就對觀測值取ln，小於0就對觀測值取一個醜倒數
    3.  library(MASS:boxcox)可以完成分析

## linear model

ANOVA

## ANOVA

## LSD test

## generate the table

## Plot the data

<!--chapter:end:04-anova.Rmd-->


# 有計畫的比較平均值

Placeholder


## 計畫性比較-簡單CRD
### glht函數
## 計畫性比較-複雜資料

<!--chapter:end:05-GLHG.Rmd-->

